<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Gûyrá</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="style.css">
      <link rel="shortcut icon" href="galery/logo-white.ico" type="image/x-icon">
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
      </head>
      
</head>
<body>
    <header>
        <div class="navpage">
         
          <nav class="navbar navbar-dark bg-dark fixed-top">
            <div class="container-fluid">
              <a class="navbar-brand" href="#"><img src="galery/logo-white.svg" alt="logo" width="65px"></a>
              <div class="aba"> <button id="meuBotao" class="btn btn-outline-warning" type="submit">Cadastro</button>
                 <button id="meuBotao1" class="btn btn-outline-warning" type="submit">Login</button>
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button></div>
              <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar" aria-labelledby="offcanvasDarkNavbarLabel">
                <div class="offcanvas-header">
                  <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">Gûyrá</h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                    <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    
                    <li class="nav-item">
                      <a class="nav-link" href="ingressos.html">Ingressos</a>
                    </li>
                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Ajuda
                      </a>
                      <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="contato.html">Contatos</a></li>
                        <li><a class="dropdown-item" href="/pi/backend/adm/funlogin.html">Login Admnistrativo</a></li>
                        <li>
                          <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="/pi/backend/adm/funlog.html">Cadastro Admnistrativo</a></li>
                      </ul>
                    </li>
                  </ul>
                  <form class="d-flex mt-3" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-warning" type="submit">Search</button>
                  </form>
                </div>
              </div>
            </div>
          </nav>
        </div></div>
        
      </header>
    
   
      <div class="container">
        <h1 class="mt-5 mb-4">Ingressos Disponíveis</h1>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="ingressos"></div>
    </div>

    <script>
        const loggedUserId = 1; // Exemplo de ID de usuário logado

        // Função para formatar data
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(dateString).toLocaleDateString('pt-BR', options);
        }

        // Função para buscar e exibir ingressos disponíveis
        async function mostrarIngressos() {
            try {
                const response = await fetch('http://localhost:5000/api/ingressos', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) throw new Error('Falha ao buscar ingressos');
                
                const data = await response.json();
                const ingressos = data.ingressos;

                const ingressosDiv = document.getElementById('ingressos');
                ingressosDiv.innerHTML = '';

                // Iterar sobre os ingressos e exibir na página
                ingressos.forEach(ingresso => {
                    const formattedDate = formatDate(ingresso.data);
                    const preco = parseFloat(ingresso.preco); // Parse preco como float
                    const quantidadeDisponivel = parseInt(ingresso.ingresso_disponivel, 10); // Parse ingresso_disponivel como inteiro

                    const ingressoDiv = document.createElement('div');
                    ingressoDiv.innerHTML = `
                        <h3>${ingresso.nome} - ${formattedDate}</h3>
                        <p>Preço: R$${!isNaN(preco) ? preco.toFixed(2) : 'N/A'}</p> <!-- Format preco com toFixed -->
                        <p>Ingressos Disponíveis: ${quantidadeDisponivel}</p>
                        <button onclick="comprarIngresso(${ingresso.id}, ${preco}, '${ingresso.tipo}')">Comprar</button>
                    `;
                    ingressosDiv.appendChild(ingressoDiv);
                });
            } catch (error) {
                console.error('Erro ao buscar ingressos:', error);
            }
        }

        // Função para criar um pedido de ingresso
        async function comprarIngresso(ingressoId, preco, ingressoTipo) {
            try {
                const response = await fetch('http://localhost:5000/api/pedidos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ingressoId: parseInt(ingressoId),
                        clienteId: loggedUserId, // Supondo que clienteId é o ID do usuário logado
                        valorPago: parseFloat(preco), // O preço permanece o mesmo
                        ingressoUsado: '1', // Converter explicitamente para string
                        ingressoTipo: ingressoTipo || '', // Garantir que ingressoTipo não seja indefinido
                        quantidade: 1 // Supondo a compra de um ingresso por vez
                    })
                });
                if (response.ok) {
                    alert('Pedido criado com sucesso!');
                    // Atualizar a lista de ingressos após a compra
                    mostrarIngressos();
                } else {
                    const data = await response.json();
                    alert('Erro ao criar pedido: ' + data.message);
                }
            } catch (error) {
                console.error('Erro ao criar pedido:', error);
            }
        }

        // Executar a função para exibir os ingressos quando a página carregar
        window.onload = mostrarIngressos;
    </script>
     <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="footer-col">
              <h4>Home</h4>
              <ul>
                <li><a href="#">Carrosel</a></li>
                <li><a href="contato.html">Sobre</a></li>
                <li><a href="#">Mapa</a></li>
                <li><a href="#"></a></li>
              </ul>
            </div>
            <div class="footer-col">
              <h4>Ajuda</h4>
              <ul>
                <li><a href="#">FAQ</a></li>
                <li><a href="contato.html">Contatos</a></li>
                <li><a href="#">Problemas de data</a></li>
                <li><a href="#">Acompanhar bilhete</a></li>
                <li><a href="atualizar_usuario.html">Alterar Conta</a></li>
              </ul>
            </div>
            <div class="footer-col">
              <h4>Compras</h4>
              <ul>
                <li><a href="ingressos.html">Ingressos</a></li>
                <li><a href="#">Bolsas</a></li>
                <li><a href="#">Comida</a></li>
                <li><a href="#">Equipamento</a></li>
              </ul>
            </div>
            <div class="footer-col">
              <h4>Nos siga</h4>
              <div class="social-links">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
              </div>
            </div>
          </div>
        </div>
     
    </footer>
  
  
  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>
  </body>
</body>
</html>
